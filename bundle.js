const MILLISECONDS_MULTIPLIER=1e3,TRANSITION_END="transitionend",toType=e=>({}.toString.call(e).match(/\s([a-z]+)/i)[1].toLowerCase()),getTransitionDurationFromElement=e=>{if(!e)return 0;let{transitionDuration:t,transitionDelay:n}=window.getComputedStyle(e);const r=parseFloat(t),a=parseFloat(n);return r||a?(t=t.split(",")[0],n=n.split(",")[0],1e3*(parseFloat(t)+parseFloat(n))):0},triggerTransitionEnd=e=>{const t=document.createEvent("HTMLEvents");t.initEvent(TRANSITION_END,!0,!0),e.dispatchEvent(t)},isElement=e=>(e[0]||e).nodeType,emulateTransitionEnd=(e,t)=>{let n=!1;const r=t+5;e.addEventListener(TRANSITION_END,(function t(){n=!0,e.removeEventListener(TRANSITION_END,t)})),setTimeout(()=>{n||triggerTransitionEnd(e)},r)},typeCheckConfig=(e,t,n)=>{Object.keys(n).forEach(r=>{const a=n[r],o=t[r],s=o&&((i=o)[0]||i).nodeType?"element":toType(o);var i;if(!new RegExp(a).test(s))throw new Error(`${e.toUpperCase()}: `+`Option "${r}" provided type "${s}" `+`but expected type "${a}".`)})},reflow=e=>e.offsetHeight,getjQuery=()=>{const{jQuery:e}=window;return e&&!document.body.hasAttribute("data-no-jquery")?e:null},mapData=(()=>{const e={};let t=1;return{set(n,r,a){void 0===n.key&&(n.key={key:r,id:t},t++),e[n.key.id]=a},get(t,n){if(!t||void 0===t.key)return null;const r=t.key;return r.key===n?e[r.id]:null},delete(t,n){if(void 0===t.key)return;const r=t.key;r.key===n&&(delete e[r.id],delete t.key)}}})(),Data={setData(e,t,n){mapData.set(e,t,n)},getData:(e,t)=>mapData.get(e,t),removeData(e,t){mapData.delete(e,t)}};let createCustomEvent=(e,t)=>new CustomEvent(e,t);"function"!=typeof window.CustomEvent&&(createCustomEvent=(e,t)=>{t=t||{bubbles:!1,cancelable:!1,detail:null};const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n});const workingDefaultPrevented=(()=>{const e=document.createEvent("CustomEvent");return e.initEvent("Bootstrap",!0,!0),e.preventDefault(),e.defaultPrevented})();if(!workingDefaultPrevented){const e=Event.prototype.preventDefault;Event.prototype.preventDefault=function(){this.cancelable&&(e.call(this),Object.defineProperty(this,"defaultPrevented",{get:()=>!0,configurable:!0}))}}const defaultPreventedPreservedOnDispatch=(()=>{const e=createCustomEvent("Bootstrap",{cancelable:!0}),t=document.createElement("div");return t.addEventListener("Bootstrap",()=>null),e.preventDefault(),t.dispatchEvent(e),e.defaultPrevented})(),supportScopeQuery=(()=>{const e=document.createElement("div");try{e.querySelectorAll(":scope *")}catch(e){return!1}return!0})(),$=getjQuery(),namespaceRegex=/[^.]*(?=\..*)\.|.*/,stripNameRegex=/\..*/,keyEventRegex=/^key/,stripUidRegex=/::\d+$/,eventRegistry={};let uidEvent=1;const customEvents={mouseenter:"mouseover",mouseleave:"mouseout"},nativeEvents=["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"];function getUidEvent(e,t){return t&&`${t}::${uidEvent++}`||e.uidEvent||uidEvent++}function getEvent(e){const t=getUidEvent(e);return e.uidEvent=t,eventRegistry[t]=eventRegistry[t]||{},eventRegistry[t]}function fixEvent(e,t){null===e.which&&keyEventRegex.test(e.type)&&(e.which=null===e.charCode?e.keyCode:e.charCode),e.delegateTarget=t}function bootstrapHandler(e,t){return function n(r){return fixEvent(r,e),n.oneOff&&EventHandler.off(e,r.type,t),t.apply(e,[r])}}function bootstrapDelegationHandler(e,t,n){return function r(a){const o=e.querySelectorAll(t);for(let{target:t}=a;t&&t!==this;t=t.parentNode)for(let s=o.length;s--;)if(o[s]===t)return fixEvent(a,t),r.oneOff&&EventHandler.off(e,a.type,n),n.apply(t,[a]);return null}}function findHandler(e,t,n=null){const r=Object.keys(e);for(let a=0,o=r.length;a<o;a++){const o=e[r[a]];if(o.originalHandler===t&&o.delegationSelector===n)return o}return null}function normalizeParams(e,t,n){const r="string"==typeof t,a=r?n:t;let o=e.replace(stripNameRegex,"");const s=customEvents[o];return s&&(o=s),nativeEvents.indexOf(o)>-1||(o=e),[r,a,o]}function addHandler(e,t,n,r,a){if("string"!=typeof t||!e)return;n||(n=r,r=null);const[o,s,i]=normalizeParams(t,n,r),l=getEvent(e),u=l[i]||(l[i]={}),c=findHandler(u,s,o?n:null);if(c)return void(c.oneOff=c.oneOff&&a);const d=getUidEvent(s,t.replace(namespaceRegex,"")),f=o?bootstrapDelegationHandler(e,n,r):bootstrapHandler(e,n);f.delegationSelector=o?n:null,f.originalHandler=s,f.oneOff=a,f.uidEvent=d,u[d]=f,e.addEventListener(i,f,o)}function removeHandler(e,t,n,r,a){const o=findHandler(t[n],r,a);o&&(e.removeEventListener(n,o,Boolean(a)),delete t[n][o.uidEvent])}function removeNamespacedHandlers(e,t,n,r){const a=t[n]||{};Object.keys(a).forEach(o=>{if(o.indexOf(r)>-1){const r=a[o];removeHandler(e,t,n,r.originalHandler,r.delegationSelector)}})}const EventHandler={on(e,t,n,r){addHandler(e,t,n,r,!1)},one(e,t,n,r){addHandler(e,t,n,r,!0)},off(e,t,n,r){if("string"!=typeof t||!e)return;const[a,o,s]=normalizeParams(t,n,r),i=s!==t,l=getEvent(e),u="."===t.charAt(0);if(void 0!==o){if(!l||!l[s])return;return void removeHandler(e,l,s,o,a?n:null)}u&&Object.keys(l).forEach(n=>{removeNamespacedHandlers(e,l,n,t.slice(1))});const c=l[s]||{};Object.keys(c).forEach(n=>{const r=n.replace(stripUidRegex,"");if(!i||t.indexOf(r)>-1){const t=c[n];removeHandler(e,l,s,t.originalHandler,t.delegationSelector)}})},trigger(e,t,n){if("string"!=typeof t||!e)return null;const r=t.replace(stripNameRegex,""),a=t!==r,o=nativeEvents.indexOf(r)>-1;let s,i=!0,l=!0,u=!1,c=null;return a&&$&&(s=$.Event(t,n),$(e).trigger(s),i=!s.isPropagationStopped(),l=!s.isImmediatePropagationStopped(),u=s.isDefaultPrevented()),o?(c=document.createEvent("HTMLEvents"),c.initEvent(r,i,!0)):c=createCustomEvent(t,{bubbles:i,cancelable:!0}),void 0!==n&&Object.keys(n).forEach(e=>{Object.defineProperty(c,e,{get:()=>n[e]})}),u&&(c.preventDefault(),defaultPreventedPreservedOnDispatch||Object.defineProperty(c,"defaultPrevented",{get:()=>!0})),l&&e.dispatchEvent(c),c.defaultPrevented&&void 0!==s&&s.preventDefault(),c}};function normalizeData(e){return"true"===e||"false"!==e&&(e===Number(e).toString()?Number(e):""===e||"null"===e?null:e)}function normalizeDataKey(e){return e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}const Manipulator={setDataAttribute(e,t,n){e.setAttribute(`data-${normalizeDataKey(t)}`,n)},removeDataAttribute(e,t){e.removeAttribute(`data-${normalizeDataKey(t)}`)},getDataAttributes(e){if(!e)return{};const t={...e.dataset};return Object.keys(t).forEach(e=>{t[e]=normalizeData(t[e])}),t},getDataAttribute:(e,t)=>normalizeData(e.getAttribute(`data-${normalizeDataKey(t)}`)),offset(e){const t=e.getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}},position:e=>({top:e.offsetTop,left:e.offsetLeft}),toggleClass(e,t){e&&(e.classList.contains(t)?e.classList.remove(t):e.classList.add(t))}},NAME="toast",VERSION="4.3.1",DATA_KEY="bs.toast",EVENT_KEY=".bs.toast",Event$1={CLICK_DISMISS:"click.dismiss.bs.toast",HIDE:"hide.bs.toast",HIDDEN:"hidden.bs.toast",SHOW:"show.bs.toast",SHOWN:"shown.bs.toast"},ClassName={FADE:"fade",HIDE:"hide",SHOW:"show",SHOWING:"showing"},DefaultType={animation:"boolean",autohide:"boolean",delay:"number"},Default={animation:!0,autohide:!0,delay:500},Selector={DATA_DISMISS:'[data-dismiss="toast"]'};class Toast{constructor(e,t){this._element=e,this._config=this._getConfig(t),this._timeout=null,this._setListeners(),Data.setData(e,DATA_KEY,this)}static get VERSION(){return"4.3.1"}static get DefaultType(){return DefaultType}static get Default(){return Default}show(){if(EventHandler.trigger(this._element,Event$1.SHOW).defaultPrevented)return;this._config.animation&&this._element.classList.add(ClassName.FADE);const e=()=>{this._element.classList.remove(ClassName.SHOWING),this._element.classList.add(ClassName.SHOW),EventHandler.trigger(this._element,Event$1.SHOWN),this._config.autohide&&(this._timeout=setTimeout(()=>{this.hide()},this._config.delay))};if(this._element.classList.remove(ClassName.HIDE),this._element.offsetHeight,this._element.classList.add(ClassName.SHOWING),this._config.animation){const t=getTransitionDurationFromElement(this._element);EventHandler.one(this._element,TRANSITION_END,e),emulateTransitionEnd(this._element,t)}else e()}hide(){if(!this._element.classList.contains(ClassName.SHOW))return;if(EventHandler.trigger(this._element,Event$1.HIDE).defaultPrevented)return;const e=()=>{this._element.classList.add(ClassName.HIDE),EventHandler.trigger(this._element,Event$1.HIDDEN)};if(this._element.classList.remove(ClassName.SHOW),this._config.animation){const t=getTransitionDurationFromElement(this._element);EventHandler.one(this._element,TRANSITION_END,e),emulateTransitionEnd(this._element,t)}else e()}dispose(){clearTimeout(this._timeout),this._timeout=null,this._element.classList.contains(ClassName.SHOW)&&this._element.classList.remove(ClassName.SHOW),EventHandler.off(this._element,Event$1.CLICK_DISMISS),Data.removeData(this._element,DATA_KEY),this._element=null,this._config=null}_getConfig(e){return e={...Default,...Manipulator.getDataAttributes(this._element),..."object"==typeof e&&e?e:{}},typeCheckConfig(NAME,e,this.constructor.DefaultType),e}_setListeners(){EventHandler.on(this._element,Event$1.CLICK_DISMISS,Selector.DATA_DISMISS,()=>this.hide())}static jQueryInterface(e){return this.each((function(){let t=Data.getData(this,DATA_KEY);if(t||(t=new Toast(this,"object"==typeof e&&e)),"string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e](this)}}))}static getInstance(e){return Data.getData(e,DATA_KEY)}}const $$1=getjQuery();if($$1){const e=$$1.fn.toast;$$1.fn.toast=Toast.jQueryInterface,$$1.fn.toast.Constructor=Toast,$$1.fn.toast.noConflict=()=>($$1.fn.toast=e,Toast.jQueryInterface)}function urlB64ToUint8Array(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new Uint8Array(n.length);for(let e=0;e<n.length;++e)r[e]=n.charCodeAt(e);return r}async function text(e){if(e.ok)return e.text();throw new Error(await e.statusCode)}async function updateSubscriptionOnServer(e){let t=await fetch("/api/v1/add_push",{method:"POST",mode:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await text(t)}function sleep(e){return new Promise(t=>setTimeout(t,e))}let isSubscribed=!1,swRegistration=null;const pushButton=document.querySelector(".js-push-btn"),applicationServerPublicKey="BAvD4b287z3xfU293G2JSKXybiHv-19mNhzlvQmmDk9drnsWhPpeSC6d9uCThC4y4abw4gjyxA8YX9Z7rk4PfvI=";async function initializeUI(){if(!("PushManager"in window))return;pushButton.addEventListener("click",async()=>{pushButton.disabled=!0,isSubscribed?await unsubscribeUser():await subscribeUser(),updateUI()});let e=await swRegistration.pushManager.getSubscription();isSubscribed=null!==e,storedIsSubscribed=null!==window.localStorage.getItem("isSubscribedOnServer"),isSubscribed&&!storedIsSubscribed?unsubscribeUser():!isSubscribed&&storedIsSubscribed&&(window.localStorage.removeItem("isSubscribedOnServer"),console.log("FAIL, set as unsubscribed on server")),updateUI()}async function subscribeUser(){const e=urlB64ToUint8Array(applicationServerPublicKey);let t=await swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e});isSubscribed=!0;try{await updateSubscriptionOnServer(t),window.localStorage.setItem("isSubscribedOnServer","1")}catch(e){alert("Fehler beim Aktivieren der Push-Benachrichtingen! "+e),await unsubscribeUser()}}async function unsubscribeUser(){window.localStorage.removeItem("isSubscribedOnServer");let e=await swRegistration.pushManager.getSubscription();await e.unsubscribe(),isSubscribed=!1}function updateUI(){"denied"===Notification.permission?(pushButton.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 18.69L7.84 6.14 5.27 3.49 4 4.76l2.8 2.8v.01c-.52.99-.8 2.16-.8 3.42v5l-2 2v1h13.73l2 2L21 19.72l-1-1.03zM12 22c1.11 0 2-.89 2-2h-4c0 1.11.89 2 2 2zm6-7.32V11c0-3.08-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68c-.15.03-.29.08-.42.12-.1.03-.2.07-.3.11h-.01c-.01 0-.01 0-.02.01-.23.09-.46.2-.68.31 0 0-.01 0-.01.01L18 14.68z"/></svg>',pushButton.disabled=!0):isSubscribed?(pushButton.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.58 4.08L6.15 2.65C3.75 4.48 2.17 7.3 2.03 10.5h2c.15-2.65 1.51-4.97 3.55-6.42zm12.39 6.42h2c-.15-3.2-1.73-6.02-4.12-7.85l-1.42 1.43c2.02 1.45 3.39 3.77 3.54 6.42zM18 11c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2v-5zm-6 11c.14 0 .27-.01.4-.04.65-.14 1.18-.58 1.44-1.18.1-.24.15-.5.15-.78h-4c.01 1.1.9 2 2.01 2z"/></svg>',pushButton.disabled=!1):(pushButton.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg>',pushButton.disabled=!1)}async function downloadAllArticles(){if("v12"===localStorage.getItem("offline"))return void console.log("articles already downloaded");await sleep(1e4);let e=await window.caches.open("v12");try{await Promise.all(["/albertforfuture.de/","/albertforfuture.de/categories/","/albertforfuture.de/categories/umwelttag/","/albertforfuture.de/umwelttag/","/albertforfuture.de/tags/bohemian-browser-ballett/","/albertforfuture.de/kohlrabi/","/albertforfuture.de/ecosia/","/albertforfuture.de/categories/empfehlungen/","/albertforfuture.de/tags/greta-thunberg/","/albertforfuture.de/rede-greta-thunberg/","/albertforfuture.de/tags/kosmetik/","/albertforfuture.de/categories/lebensmittelverschwendung/","/albertforfuture.de/tags/meer/","/albertforfuture.de/protokoll/2019-11-19/","/albertforfuture.de/protokoll/2019-10-24/","/albertforfuture.de/categories/mensa-talk/","/albertforfuture.de/mikroplastik-in-kosmetik/","/albertforfuture.de/categories/plastik/","/albertforfuture.de/categories/politik/","/albertforfuture.de/protokoll/","/albertforfuture.de/categories/protokoll/","/albertforfuture.de/protokoll/2019-12-03/","/albertforfuture.de/tags/satire/","/albertforfuture.de/tags/suchmaschine/","/albertforfuture.de/tags/","/albertforfuture.de/plastik-im-meer/","/albertforfuture.de/categories/aktuelles/","/albertforfuture.de/datenschutzerklaerung/","/albertforfuture.de/offline/","/albertforfuture.de/impressum/","/albertforfuture.de/infos/"].map(async t=>{let n=await fetch(t);await text(n.clone());if(new URL(n.url).pathname!==t)throw new Error("offline");await e.put(t,n)})),localStorage.setItem("offline","v12"),document.getElementById("toast-offline").classList.remove("d-none"),new Toast(document.getElementById("toast-offline"),{delay:5e3}).show(),document.getElementById("toast-offline").addEventListener("hidden.bs.toast",(function(){document.getElementById("toast-offline").remove()}))}catch(e){console.log("failed to download articles",e)}}async function main(){"serviceWorker"in navigator?window.addEventListener("load",async()=>{let e=await navigator.serviceWorker.register("https://mohe2015.github.io/albertforfuture.de/sw.min.js",{scope:"https://mohe2015.github.io/albertforfuture.de/"});console.log("Service Worker is registered",e),swRegistration=e,await initializeUI(),swRegistration.active&&"activated"===swRegistration.active.state&&(console.log("active",swRegistration.active),await downloadAllArticles()),swRegistration.installing&&swRegistration.installing.addEventListener("statechange",(async function(){console.log('[controllerchange][statechange] A "statechange" has occured: ',this.state),"activated"===this.state&&await downloadAllArticles()}))}):console.warn("Service worker not supported!")}main();